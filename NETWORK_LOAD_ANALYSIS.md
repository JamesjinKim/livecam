# 분산 CCTV 시스템 네트워크 부하 분석

## 1. 기본 대역폭 계산

### 카메라별 데이터 전송량
| 해상도 | 비트레이트 | 초당 데이터 | 시간당 데이터 | 일일 데이터 |
|--------|------------|-------------|---------------|-------------|
| 480p (854×480) | 2-3 Mbps | 0.25-0.375 MB/s | 0.9-1.35 GB/h | 21.6-32.4 GB |
| 720p (1280×720) | 5-10 Mbps | 0.625-1.25 MB/s | 2.25-4.5 GB/h | 54-108 GB |
| 1080p (1920×1080) | 10-20 Mbps | 1.25-2.5 MB/s | 4.5-9 GB/h | 108-216 GB |

### 전체 시스템 (6카메라 기준)
| 시나리오 | 총 비트레이트 | 초당 데이터 | 시간당 데이터 | 일일 데이터 |
|----------|---------------|-------------|---------------|-------------|
| 최소 (480p) | 12-18 Mbps | 1.5-2.25 MB/s | 5.4-8.1 GB/h | 129.6-194.4 GB |
| **표준 (720p)** | **30-60 Mbps** | **3.75-7.5 MB/s** | **13.5-27 GB/h** | **324-648 GB** |
| 최대 (1080p) | 60-120 Mbps | 7.5-15 MB/s | 27-54 GB/h | 648-1296 GB |

## 2. 네트워크 인프라 부하

### 기가비트 이더넷 (1000 Mbps) 기준
```
사용률 = (실제 사용 대역폭 / 최대 대역폭) × 100

720p 6카메라 기준:
- 최소: 30 Mbps / 1000 Mbps = 3% 사용률
- 최대: 60 Mbps / 1000 Mbps = 6% 사용률
```

### 100Mbps 이더넷 기준
```
720p 6카메라 기준:
- 최소: 30 Mbps / 100 Mbps = 30% 사용률
- 최대: 60 Mbps / 100 Mbps = 60% 사용률
```

## 3. 실제 네트워크 부하 요소

### 추가 오버헤드
| 요소 | 추가 부하 | 설명 |
|------|-----------|------|
| 프로토콜 오버헤드 | +10-15% | TCP/IP 헤더, HTTP 헤더 |
| 재전송 | +5-10% | 패킷 손실 시 재전송 |
| 제어 트래픽 | +2-3% | 하트비트, 상태 체크 |
| **총 오버헤드** | **+17-28%** | |

### 실제 필요 대역폭
```
720p 6카메라:
- 이론값: 30-60 Mbps
- 실제 필요: 35-77 Mbps (오버헤드 포함)
```

## 4. 네트워크 장비별 영향

### 라즈베리파이 5 네트워크 성능
- **이더넷**: 1 Gbps (실제 처리량 ~940 Mbps)
- **CPU 부하**: 60 Mbps 처리 시 ~5-7% CPU 사용
- **메모리 버퍼**: ~50-100 MB 필요

### 스위치/라우터 부하
| 장비 등급 | 권장 카메라 수 | 부하 수준 |
|-----------|---------------|-----------|
| 100 Mbps 스위치 | 2-3개 | 높음 (60-90%) |
| 1 Gbps 스위치 | 6-10개 | 낮음 (6-10%) |
| 관리형 스위치 | 10-20개 | 최적 (QoS 지원) |

## 5. 클라이언트 동시 접속 시 부하

### 시나리오별 분석
| 접속자 수 | 스트림 방식 | 추가 부하 | 총 대역폭 |
|-----------|------------|-----------|-----------|
| 1명 | 직접 스트림 | 0% | 30-60 Mbps |
| 5명 | 직접 스트림 | +400% | 150-300 Mbps |
| 5명 | 트랜스코딩 | +100% | 60-120 Mbps |
| 10명 | CDN/캐싱 | +50% | 45-90 Mbps |

## 6. 병목 지점 분석

### 잠재적 병목 지점
1. **라즈베리파이 → 스위치**: 문제없음 (1 Gbps)
2. **스위치 → NAS**: 주의 필요 (모든 트래픽 집중)
3. **NAS → 클라이언트**: 업링크 대역폭 확인 필요
4. **인터넷 업로드**: 외부 접속 시 ISP 업로드 속도 중요

### 권장 네트워크 구성
```
[RPi × 3] ---(1 Gbps)---> [기가비트 스위치]
                                 |
                           (1 Gbps)
                                 ↓
                            [NAS 서버]
                                 |
                           (1 Gbps)
                                 ↓
                         [인터넷 라우터]
```

## 7. 최적화 방안

### 대역폭 절감 방법
| 방법 | 절감률 | 구현 난이도 |
|------|--------|------------|
| H.265 코덱 사용 | 40-50% | 중간 |
| 적응형 비트레이트 | 20-30% | 높음 |
| 동작 감지 녹화 | 60-80% | 낮음 |
| 키프레임 최적화 | 10-15% | 낮음 |

### 네트워크 설정 최적화
```bash
# TCP 버퍼 크기 증가
sudo sysctl -w net.core.rmem_max=134217728
sudo sysctl -w net.core.wmem_max=134217728

# 네트워크 인터페이스 최적화
sudo ethtool -G eth0 rx 4096 tx 4096
sudo ethtool -K eth0 gro on gso on tso on
```

## 8. 실제 부하 테스트 결과 예상

### 정상 운영 시 (720p, 6카메라)
- **네트워크 사용률**: 6-8% (기가비트 기준)
- **CPU 사용률**: 각 RPi 15-20%
- **메모리 사용**: 각 RPi 200-300 MB
- **지연시간**: 50-80ms

### 피크 시간 (모든 클라이언트 접속)
- **네트워크 사용률**: 15-20%
- **CPU 사용률**: 각 RPi 30-40%
- **메모리 사용**: 각 RPi 400-500 MB
- **지연시간**: 80-120ms

## 9. 네트워크 모니터링 지표

### 핵심 모니터링 항목
```python
# 실시간 모니터링 필요 지표
metrics = {
    "bandwidth_usage": "Mbps",      # 대역폭 사용량
    "packet_loss": "%",              # 패킷 손실률
    "latency": "ms",                 # 지연시간
    "jitter": "ms",                  # 지터
    "buffer_usage": "MB",            # 버퍼 사용량
    "connection_count": "개",        # 연결 수
}
```

## 10. 결론 및 권장사항

### 네트워크 부하 수준
- **기가비트 네트워크**: **매우 낮음** (6-8% 사용)
- **100Mbps 네트워크**: **중간-높음** (60% 사용)
- **권장**: 기가비트 스위치 + Cat6 케이블

### 확장 가능성
- 현재 구성으로 **20개 카메라**까지 확장 가능
- NAS 네트워크 인터페이스 이중화 권장
- 향후 10 Gbps 백본 고려

### 예상 월간 트래픽
```
720p 6카메라 24시간 운영:
- 로컬 네트워크: 약 10-20 TB/월
- 인터넷 (외부 접속 10%): 약 1-2 TB/월
```

---
**작성일**: 2025-09-19
**참고**: 실제 부하는 압축률, 화면 복잡도, 움직임 양에 따라 변동


● 네트워크 부하 상세 분석을 작성했습니다.

  핵심 요약:
  - 기가비트 네트워크: 6-8% 사용률 (매우 여유로움)
  - 100Mbps 네트워크: 60% 사용률 (주의 필요)
  - 실제 필요 대역폭: 35-77 Mbps (오버헤드 포함)
  - 일일 데이터량: 324-648 GB
  - 월간 트래픽: 10-20 TB

  기가비트 스위치 사용 시 네트워크 부하는 거의 문제가 되지 않으며, 20개
  카메라까지 확장 가능합니다.