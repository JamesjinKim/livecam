# Livecam 중앙 저장 시스템 PRD (Product Requirements Document)

## 1. 개요 (Overview)

본 문서는 'Livecam 중앙 저장 시스템'의 제품 요구사항을 정의합니다.

현재 다수의 라즈베리파이5가 각자의 로컬 저장소에 카메라 영상을 독립적으로 저장하고 있습니다. 이 방식은 데이터 관리의 파편화, 저장 공간의 한계, 그리고 사용자의 접근성 문제를 야기합니다.

본 프로젝트는 각 라즈베리파이에서 녹화된 영상을 내부 네트워크의 중앙 NAS(Network Attached Storage)로 통합하여 저장하고, 사용자가 웹 인터페이스를 통해 해당 영상을 편리하게 검색하고 재생할 수 있는 시스템을 구축하는 것을 목표로 합니다.

## 2. 목표 (Goals)

- **중앙 집중식 영상 데이터 관리**: 모든 영상 데이터를 단일 NAS에 저장하여 관리 효율성을 극대화합니다.
- **저장 공간 확장성 확보**: 개별 라즈베리파이의 저장 공간 제약에서 벗어나 NAS를 통해 유연하게 저장 용량을 확장합니다.
- **사용자 접근성 및 편의성 향상**: 사용자는 하나의 웹 애플리케이션을 통해 모든 카메라의 녹화 영상을 시간/장소에 구애받지 않고 확인할 수 있습니다.
- **안정적인 녹화 환경 구축**: 각 라즈베리파이는 녹화와 전송 기능에만 집중하여 시스템 부하를 최소화하고 안정성을 높입니다.

## 3. 사용자 페르소나 (User Personas)

- **시스템 관리자**:
    - 전체 시스템(라즈베리파이, NAS, 웹 서버)의 상태를 모니터링하고 관리합니다.
    - 새로운 카메라(라즈베리파이)를 시스템에 쉽게 추가하거나 제거할 수 있어야 합니다.
    - 저장 공간 정책(예: 오래된 파일 자동 삭제)을 설정하고 관리합니다.
- **일반 사용자**:
    - 웹 브라우저를 통해 시스템에 접속합니다.
    - 특정 카메라 또는 날짜/시간을 기준으로 원하는 녹화 영상을 쉽게 찾아 재생할 수 있어야 합니다.

## 4. 시스템 아키텍처 (System Architecture)

```text
+--------------------------+
|      사용자 (User)       |
+--------------------------+
      |         ^
      | 1. 영상 목록/재생 요청 (HTTP)
      v         | 3. 영상 목록 응답
+--------------------------+
| Livecam Hub 서버 (WebApp)|
+--------------------------+
      |         ^
      | 2. 메타데이터 조회
      v         | 5. 영상 파일 URL 제공 / 6. 영상 스트림 재생
+--------------------------+
|     NAS (중앙 저장소)      |
+--------------------------+
      ^         ^
      | 4. 영상  |         | 4. 영상
      | 전송     |         | 전송
      | (NFS/SMB)|         | (NFS/SMB)
+-------------+  +-------------+
| RPi 1 + Cam |  | RPi 2 + Cam | ...
+-------------+  +-------------+
```

- **Edge Node (Raspberry Pi + Camera)**:
    - 카메라로부터 영상 스트림을 받아 지정된 형식(예: MP4)으로 녹화합니다.
    - 녹화된 영상 파일을 실시간 또는 주기적으로 중앙 NAS의 지정된 경로로 전송합니다. (NFS, SMB/CIFS 프로토콜 사용)
    - 각 파일은 카메라 ID와 타임스탬프를 포함하는 명확한 규칙으로 작명됩니다. (예: `cam01_20250923_153000.mp4`)
- **Storage (NAS)**:
    - 모든 라즈베리파이로부터 전송된 영상 파일을 저장하는 중앙 저장소입니다.
    - 카메라별, 날짜별로 영상이 저장될 수 있도록 구조화된 디렉토리 구조를 가집니다. (예: `/videos/cam01/2025-09-23/`)
- **Application (Livecam Hub Server)**:
    - 사용자와의 상호작용을 위한 웹 인터페이스(`index.html`)와 API(`api.py`)를 제공합니다.
    - 주기적으로 NAS의 파일 시스템을 스캔하여 영상 목록을 데이터베이스화하거나 동적으로 생성합니다.
    - 사용자의 요청에 따라 영상 목록을 제공하고, NAS에 저장된 영상 파일에 접근할 수 있는 URL을 생성하여 전달합니다.

## 5. 기능 요구사항 (Functional Requirements)

### 5.1. Edge Node (Raspberry Pi)
- [ ] **FR-1**: 설정된 해상도와 프레임레이트로 카메라 영상을 지속적으로 녹화해야 한다.
- [ ] **FR-2**: 녹화 파일은 일정 시간 또는 용량 단위로 분할하여 생성해야 한다.
- [ ] **FR-3**: 생성된 영상 파일을 중앙 NAS의 `/{camera_id}/{date}/` 경로에 자동으로 업로드해야 한다.
- [ ] **FR-4**: 네트워크 연결이 일시적으로 끊겼을 경우, 로컬에 임시 저장 후 연결이 복구되면 전송을 재개해야 한다. (Error Handling)
- [ ] **FR-5**: 각 라즈베리파이는 자신의 카메라 ID, NAS 경로 등 설정 정보를 `config.json`과 같은 파일에서 읽어와야 한다.

### 5.2. Livecam Hub Server (Web Application)
- [ ] **FR-6**: 사용자가 접속할 수 있는 메인 페이지(`index.html`)를 제공해야 한다.
- [ ] **FR-7**: NAS에 저장된 영상 목록을 API를 통해 제공해야 한다.
    - [ ] 카메라 ID별 필터링 기능
    - [ ] 날짜 및 시간 범위별 검색 기능
- [ ] **FR-8**: 사용자가 선택한 영상을 웹 페이지 내에서 스트리밍으로 재생할 수 있는 플레이어를 제공해야 한다.
- [ ] **FR-9**: 각 Edge Node(라즈베리파이)의 현재 상태(온라인/오프라인)를 보여주는 간단한 대시보드 기능을 제공해야 한다.

### 5.3. Storage (NAS)
- [ ] **FR-10**: 라즈베리파이들이 영상을 쓸 수 있도록 NFS 또는 SMB/CIFS 공유 폴더를 제공해야 한다.
- [ ] **FR-11**: 설정된 보관 기간(예: 30일)이 지난 영상은 자동으로 삭제하는 스크립트 또는 기능을 갖추어야 한다. (저장 공간 관리)

## 6. 비기능 요구사항 (Non-Functional Requirements)

- **NFR-1 (성능)**: 사용자가 영상 재생을 요청했을 때 3초 이내에 스트리밍이 시작되어야 한다.
- **NFR-2 (확장성)**: 새로운 라즈베리파이 카메라를 추가할 때 서버 코드의 변경 없이 설정만으로 시스템에 통합될 수 있어야 한다.
- **NFR-3 (안정성)**: 특정 라즈베리파이의 장애가 전체 시스템 또는 다른 카메라의 녹화에 영향을 주지 않아야 한다.
- **NFR-4 (보안)**: 허가된 사용자만이 영상 목록 조회 및 재생을 할 수 있도록 간단한 인증 절차를 고려해야 한다. (선택 사항)

## 7. 향후 계획 (Future Scope)

- 실시간 라이브 스트리밍 기능 추가
- 영상 내 특정 이벤트(움직임 감지 등)를 감지하고 기록하는 기능
- 시스템 상태 이상(카메라 오프라인, 저장 공간 부족 등) 발생 시 관리자에게 알림 전송 기능
- 클라우드 스토리지와 연동한 백업 기능
