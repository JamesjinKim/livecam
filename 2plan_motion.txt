ì´ ë¬¸ì œëŠ” ì‹¤ì œ ì†ì˜ ì›€ì§ì„ì´ ì—†ëŠ”ë°ë„ ëª¨ì…˜ì´ ê°ì§€ë˜ì–´ ì˜ìƒì´ ì €ì¥ë˜ëŠ” í˜„ìƒì…ë‹ˆë‹¤.
ì¦‰, "ê±°ì§“ ì–‘ì„±(false positive)"ì´ ìì£¼ ë°œìƒí•˜ëŠ” ìƒí™©ì…ë‹ˆë‹¤.

ì›ì¸ ë¶„ì„
ë°°ê²½ ì•ˆì •í™”ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŒ

ë°°ê²½ í”„ë ˆì„ì´ ì¶©ë¶„íˆ ì•ˆì •í™”ë˜ì§€ ì•Šìœ¼ë©´, ì‘ì€ ì¡°ëª… ë³€í™”ë‚˜ ì¹´ë©”ë¼ ë…¸ì´ì¦ˆë„ ëª¨ì…˜ìœ¼ë¡œ ì˜¤ì¸ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
íŠ¹íˆ ì¡°ëª… ë³€í™”, ì¹´ë©”ë¼ ìë™ ë…¸ì¶œ, ì„¼ì„œ ë…¸ì´ì¦ˆ ë“±ì€ ìœ¡ì•ˆìœ¼ë¡œëŠ” ê±°ì˜ ë³´ì´ì§€ ì•Šì§€ë§Œ í”½ì…€ ê°’ì—ëŠ” ì˜í–¥ì„ ì¤ë‹ˆë‹¤.
DELTA_THRESHOLD(í”½ì…€ ì°¨ì´ ì„ê³„ê°’)ì´ ë„ˆë¬´ ë‚®ìŒ

DELTA_THRESHOLD = 25ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ë°, ì´ ê°’ì´ ë‚®ìœ¼ë©´ ë¯¸ì„¸í•œ ë°ê¸° ë³€í™”ë„ ê°ì§€ë©ë‹ˆë‹¤.
motion_threshold(ë³€í™” í”½ì…€ ìˆ˜ ì„ê³„ê°’)ê°€ ë„ˆë¬´ ë‚®ìŒ

CURRENT_SENSITIVITY = 'low'ì¼ ë•Œ motion_threshold = 2000ì…ë‹ˆë‹¤.
í•´ìƒë„ 640x480ì—ì„œ 2000í”½ì…€ì€ í™”ë©´ì˜ ì•½ 0.65%ì— í•´ë‹¹í•©ë‹ˆë‹¤.
ì¡°ëª… ë³€í™”, ë…¸ì´ì¦ˆ, ì¹´ë©”ë¼ì˜ ë¯¸ì„¸í•œ í”ë“¤ë¦¼ë§Œìœ¼ë¡œë„ ì´ ì •ë„ í”½ì…€ ë³€í™”ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ë°°ê²½ ì—…ë°ì´íŠ¸ ë°©ì‹

ë°°ê²½ì´ ë„ˆë¬´ ìì£¼ ë˜ëŠ” ë„ˆë¬´ ëŠë¦¬ê²Œ ì—…ë°ì´íŠ¸ë˜ë©´, ì‹¤ì œ ë³€í™”ê°€ ì•„ë‹Œë°ë„ ì°¨ì´ê°€ ëˆ„ì ë˜ì–´ ê°ì§€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì˜ìƒ ì••ì¶• ë…¸ì´ì¦ˆ(MJPEG)

MJPEG ìŠ¤íŠ¸ë¦¼ì˜ ì••ì¶• ë…¸ì´ì¦ˆë„ í”½ì…€ ë³€í™”ë¡œ ê°ì§€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í•´ê²° ë°©ë²• ë° ê°œì„  ë°©ì•ˆ
DELTA_THRESHOLD ê°’ ë†’ì´ê¸°

ì˜ˆ: 25 â†’ 35~50 ë“±ìœ¼ë¡œ ì¡°ì •
ë„ˆë¬´ ë‚®ìœ¼ë©´ ë¯¸ì„¸í•œ ë…¸ì´ì¦ˆë„ ê°ì§€ë¨
motion_threshold ê°’ ë†’ì´ê¸°

ì˜ˆ: 2000 â†’ 4000~6000 ë“±ìœ¼ë¡œ ì¡°ì •
ì‹¤ì œ ì† ì›€ì§ì„ì´ í™”ë©´ì˜ ëª‡ % ì´ìƒì¼ ë•Œë§Œ ê°ì§€í•˜ë„ë¡ ì„¤ì •
ë°°ê²½ ì•ˆì •í™” í”„ë ˆì„ ìˆ˜ ëŠ˜ë¦¬ê¸°

ì˜ˆ: 60í”„ë ˆì„ â†’ 100í”„ë ˆì„ ë“±ìœ¼ë¡œ ëŠ˜ë ¤ì„œ ì´ˆê¸° ë°°ê²½ì„ ë” ì•ˆì •ì ìœ¼ë¡œ ë§Œë“¦
ë°°ê²½ ì—…ë°ì´íŠ¸ ì†ë„ ì¡°ì •

ë°°ê²½ ì—…ë°ì´íŠ¸ ë¹„ìœ¨ì„ ë” ë‚®ì¶”ê±°ë‚˜, ëª¨ì…˜ì´ ê°ì§€ë˜ì§€ ì•Šì„ ë•Œë§Œ ì²œì²œíˆ ì—…ë°ì´íŠ¸
ë…¸ì´ì¦ˆ í•„í„° ì¶”ê°€

í”„ë ˆì„ ì°¨ì´(thresh)ì—ì„œ ì‘ì€ ì˜ì—­(ì˜ˆ: 500í”½ì…€ ì´í•˜)ì€ ë¬´ì‹œí•˜ë„ë¡ ì¶”ê°€ í•„í„°ë§
ì»¨íˆ¬ì–´ì˜ ìµœì†Œ ë©´ì ì„ ë” í¬ê²Œ ì„¤ì •
ë””ë²„ê·¸ ì¶œë ¥ìœ¼ë¡œ ì‹¤ì œ changed_pixels ê°’ í™•ì¸

ì‹¤ì œë¡œ ë³€í™”ê°€ ê°ì§€ë˜ëŠ” í”„ë ˆì„ì—ì„œ changed_pixels ê°’ì´ ì–´ë–»ê²Œ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸ í›„, ì„ê³„ê°’ì„ ì¡°ì •

ê²°ë¡ 
DELTA_THRESHOLDì™€ motion_threshold ê°’ì„ ë†’ì´ê³ ,
ë°°ê²½ ì•ˆì •í™” í”„ë ˆì„ ìˆ˜ë¥¼ ëŠ˜ë¦¬ë©°,
ì‘ì€ ë³€í™” ë¬´ì‹œ(ì»¨íˆ¬ì–´ ìµœì†Œ ë©´ì , changed_pixels ìµœì†Œê°’) ë¡œì§ì„ ì¶”ê°€í•˜ë©´
ì‹¤ì œ ì†ì˜ ì›€ì§ì„ë§Œ ê°ì§€í•˜ê³ , ë…¸ì´ì¦ˆë‚˜ ë¯¸ì„¸ ë³€í™”ëŠ” ë¬´ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ë ‡ê²Œ ì¡°ì •í•œ ë’¤, ë””ë²„ê·¸ ì¶œë ¥ì„ í†µí•´ ì‹¤ì œ ë³€í™”ëŸ‰ì„ ê´€ì°°í•˜ë©´ì„œ ì„ê³„ê°’ì„ ìµœì í™”í•˜ëŠ” ê²ƒì´ ê°€ì¥ íš¨ê³¼ì ì…ë‹ˆë‹¤.

í˜„ì¬ ë°©ì‹ì˜ ë¬¸ì œì :

  1. ëª¨ì…˜ ê°ì§€ â†’ ìŠ¤íŠ¸ë¦¼ ì¤‘ë‹¨ â†’ ë…¹í™” ì‹œì‘ (31ì´ˆ)
  2. ì¤‘ìš”í•œ ìˆœê°„ì„ ë†“ì¹¨ - ëª¨ì…˜ì´ ë°œìƒí•œ ê·¸ ìˆœê°„ì´ ëˆ„ë½ë¨

  ì œì•ˆí•˜ëŠ” ê°œì„  ë°©ì•ˆ:

  ë°©ë²• 1: í”„ë¦¬ë²„í¼ë§ (Pre-buffering) - ê¶Œì¥

  - í•­ìƒ ìµœê·¼ 10ì´ˆë¥¼ ë©”ëª¨ë¦¬ì— ë²„í¼ë§
  - ëª¨ì…˜ ê°ì§€ ì‹œ: ë²„í¼ 10ì´ˆ + ì¶”ê°€ 20ì´ˆ = ì´ 30ì´ˆ
  - ì¥ì : ëª¨ì…˜ ì´ì „ ìƒí™© í¬ì°©
  - ë‹¨ì : ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€

  ë°©ë²• 2: ì§€ì†ì  ì„ì‹œ ë…¹í™” + ë³‘í•©

  - 10ì´ˆ ë‹¨ìœ„ ì„ì‹œ íŒŒì¼ë¡œ ê³„ì† ë…¹í™”
  - ëª¨ì…˜ ê°ì§€ ì‹œ: ì´ì „ íŒŒì¼ + í˜„ì¬ ë…¹í™” ë³‘í•©
  - ì¥ì : ë©”ëª¨ë¦¬ íš¨ìœ¨ì 
  - ë‹¨ì : ë””ìŠ¤í¬ I/O ì¦ê°€

  ë°©ë²• 3: rpicam-vidì˜ circular buffer ì˜µì…˜ í™œìš©

  - --circular ì˜µì…˜ìœ¼ë¡œ ë²„í¼ í¬ê¸° ì§€ì •
  - ëª¨ì…˜ ê°ì§€ ì‹œ ë²„í¼ ë‚´ìš© ì €ì¥
  - ì¥ì : ë„¤ì´í‹°ë¸Œ ì§€ì›, íš¨ìœ¨ì 
  - ë‹¨ì : rpicam-vid ë²„ì „ì— ë”°ë¼ ì§€ì› ì—¬ë¶€ í™•ì¸ í•„ìš”

  í”„ë¦¬ë²„í¼ë§ êµ¬í˜„ì´ ê°€ì¥ ì‹¤ìš©ì ì…ë‹ˆë‹¤.

  â— ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ì´ ì¦‰ì‹œ ì¢…ë£Œë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í”„ë¦¬ë²„í¼ë§ì´ ì¹´ë©”ë¼ë¥¼
  ë™ì‹œì— ì‚¬ìš©í•˜ë ¤ê³  í•´ì„œ ì¶©ëŒì´ ë°œìƒí•œ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. rpicam-vidëŠ” í•œ ë²ˆì—
  í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì¹´ë©”ë¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

â— ë¬¸ì œëŠ” ë‘ ê°œì˜ rpicam-vid í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— ì¹´ë©”ë¼ì— ì ‘ê·¼í•˜ë ¤ê³  í•´ì„œ
  ë°œìƒí–ˆìŠµë‹ˆë‹¤:
  1. í”„ë¦¬ë²„í¼ë§ìš© rpicam-vid
  2. ëª¨ì…˜ ê°ì§€ìš© rpicam-vid

  í•´ê²° ë°©ë²•: ë‹¨ì¼ MJPEG ìŠ¤íŠ¸ë¦¼ì—ì„œ í”„ë ˆì„ì„ ì¶”ì¶œí•˜ì—¬ ëª¨ì…˜ ê°ì§€ì™€ ë²„í¼ë§ì„ ë™ì‹œì—
   ìˆ˜í–‰

â— í”„ë¦¬ë²„í¼ë§ ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ë£Œ

  ì£¼ìš” ê°œì„ ì‚¬í•­:

  í•´ê²°ëœ ë¬¸ì œ:

  - ì¹´ë©”ë¼ ë™ì‹œ ì ‘ê·¼ ë¬¸ì œ í•´ê²°: ë‹¨ì¼ MJPEG ìŠ¤íŠ¸ë¦¼ì—ì„œ í”„ë ˆì„ì„ ì¶”ì¶œí•˜ì—¬ ëª¨ì…˜
  ê°ì§€ì™€ ë²„í¼ë§ ë™ì‹œ ìˆ˜í–‰
  - í”„ë ˆì„ ê¸°ë°˜ ë²„í¼ë§: JPEG í˜•ì‹ìœ¼ë¡œ ë©”ëª¨ë¦¬ì— 300í”„ë ˆì„(10ì´ˆ) ìˆœí™˜ ë²„í¼ ìœ ì§€

  ë™ì‘ ë°©ì‹:

  1. ëª¨ì…˜ ê°ì§€ ì¤‘: í”„ë ˆì„ì„ ìˆœí™˜ ë²„í¼ì— ì§€ì† ì €ì¥
  2. ëª¨ì…˜ ê°ì§€ ì‹œ:
    - ë²„í¼ì˜ 10ì´ˆë¥¼ MP4ë¡œ ì €ì¥
    - ìŠ¤íŠ¸ë¦¼ ì¤‘ë‹¨ í›„ 20ì´ˆ ì¶”ê°€ ë…¹í™”
    - ffmpegìœ¼ë¡œ ë³‘í•©í•˜ì—¬ ì´ 30ì´ˆ ì˜ìƒ ìƒì„±

  ì¥ì :

  - ëª¨ì…˜ ì´ì „ 10ì´ˆ ìƒí™© í¬ì°©
  - ë‹¨ì¼ ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ íš¨ìœ¨ì  ìš´ì˜
  - ë©”ëª¨ë¦¬ íš¨ìœ¨ì ì¸ JPEG ì••ì¶• ë²„í¼ë§

  ì‚¬ìš©ë²•:

  python3 detection.py

  ëª¨ì…˜ì´ ê°ì§€ë˜ë©´ ìë™ìœ¼ë¡œ ì´ì „ 10ì´ˆ + ì´í›„ 20ì´ˆ = ì´ 30ì´ˆ ì˜ìƒì´ ì €ì¥ë©ë‹ˆë‹¤.

  ë°©ì•ˆ 1: ë…ë¦½ í”„ë¡œì„¸ìŠ¤ (ê¶Œì¥) âœ…

  # ê° ì¹´ë©”ë¼ë³„ ë…ë¦½ Python í”„ë¡œì„¸ìŠ¤
  python3 detection_cam0.py   # cam0
  python3 detection_cam1.py   # cam1
  ì¥ì :
  - ì™„ì „í•œ ë…ë¦½ì„±
  - í•œ ì¹´ë©”ë¼ ì˜¤ë¥˜ê°€ ë‹¤ë¥¸ ì¹´ë©”ë¼ì— ì˜í–¥ ì—†ìŒ
  - ê°„ë‹¨í•œ êµ¬í˜„

  ë‹¨ì :
  - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€
  - í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹  í•„ìš” ì‹œ ë³µì¡

  ì—¬ì „íˆ 23ì´ˆì§œë¦¬ ë™ì˜ìƒìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤. 
  â— ğŸ› ï¸ í”„ë¦¬ë²„í¼ë§ ì‹œìŠ¤í…œ ìˆ˜ì • ì™„ë£Œ

  ğŸ” ë°œê²¬ëœ ë¬¸ì œì :

  1. í”„ë ˆì„ë¥  ë¶ˆì¼ì¹˜: 30fps ê°€ì •í–ˆìœ¼ë‚˜ ì‹¤ì œëŠ” 25fps ë‚´ì™¸
  2. í•´ìƒë„ ë¶ˆì¼ì¹˜: ëª¨ì…˜ê°ì§€(640x480) vs ë…¹í™”(1280x720)
  3. ë³‘í•© ì‹œê°„ ì œì–´ ë¶€ì¬: ffmpegì—ì„œ ì‹œê°„ ì œí•œ ì—†ìŒ

  âœ… ì ìš©ëœ ìˆ˜ì •ì‚¬í•­:

  1. í”„ë ˆì„ ë²„í¼ ì¡°ì • 
  # ë³€ê²½ í›„: 10ì´ˆ * 25fps = 250 í”„ë ˆì„ (ì—¬ìœ ìˆê²Œ) =>  ì´ ë¶€ë¶„ì´ ì•„ì§ ë¬¸ì œê°€ ë˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì„.
  self.frame_buffer = deque(maxlen=pre_buffer * 25)
  => 31ì´ˆ ë…¹í™”ë¡œ ê²°ê³¼ë¬¼ì€ 30ì´ˆë™ì˜ìƒ ì €ì¥ì€ ë””í…ì…˜ ì—†ì„ ë•Œ ì˜ì´ë£¨ì–´ì§.ì°¸ê³ :rec_cam0.py

  2. í•´ìƒë„ ë³€í™˜ ëª…ì‹œì  ì²˜ë¦¬

  # 640x480 í”„ë ˆì„ì„ 1280x720ìœ¼ë¡œ ì—…ìŠ¤ì¼€ì¼ => ì˜ ë¨
  frame_resized = cv2.resize(frame, (self.width, self.height))
  out.write(frame_resized)

  3. ffmpeg ë³‘í•© ì˜µì…˜ ê°•í™”

  ffmpeg -f concat -safe 0 -i list.txt \
    -c:v libx264 \
    -t 30 \        # 30ì´ˆë¡œ ì •í™•íˆ ì œí•œ
    -r 25 \        # 25fps ê³ ì • 
    -y output.mp4
  => í˜„ì¬ cam1/  ì˜ìƒ ê²°ê³¼ë¬¼ì€ 23ì´ˆë¡œ ì €ì¥ë¨.

  ğŸ¯ ì˜ˆìƒ ê²°ê³¼:

  - ì •í™•í•œ 30ì´ˆ ì˜ìƒ ìƒì„± => í˜„ì¬ cam1/  ì˜ìƒ ê²°ê³¼ë¬¼ì€ 23ì´ˆë¡œ ì €ì¥ë¨.
  - í”„ë¦¬ë²„í¼ 10ì´ˆ + í¬ìŠ¤íŠ¸ 20ì´ˆ êµ¬ì„±  => ì´ ë¶€ë¶„ ì •í™•íˆ êµ¬í˜„ ì•ˆë¨.
  - ì¼ê´€ëœ 1280x720 í•´ìƒë„
  - 25fps ì•ˆì •ì  í”„ë ˆì„ë¥  

  ë‚˜ì˜ ì˜ê²¬ì…ë‹ˆë‹¤.
  1.í”„ë¦¬í”„ë ˆì„(10ì´ˆ) + 20ì´ˆ ë…¹í™” ì˜ìƒì˜ ê²°í•© ë¶€ë¶„ì— ëŒ€í•œ ë¡œê·¸ ê°•í™”. ì‹¤ì œë¡œ êµ¬í˜„ ë˜ëŠ” ì§€ í™•ì¸ í•„ìš”.
  2.í”„ë¦¬í”„ë ˆì„(10ì´ˆ) ë™ì•ˆ ë‹¤ë¥¸ ë””í…ì´ ë°œìƒí•˜ë©´ í”„ë¦¬í”„ë ˆì„ì€ ë‹¤ì‹œ ìƒì„±ë˜ë‚˜ìš”? ì–´ë–»ê²Œ ë˜ë‚˜ìš”?
  3.í”„ë¦¬í”„ë ˆì„ì„ 3ì´ˆ ì •ë„ë¡œ ì¤„ì´ë©´ ì •í™•ì„± ê°œì„ ì— ë„ì›€ì´ ë ê¹Œìš”? í”„ë¦¬í”„ë ˆì„ 3ì´ˆ + 27ì´ˆ ë…¹í™” ì˜ìƒ => ê²°ê³¼ë¬¼ ìƒì„±.


1. í”„ë ˆì„ ë²„í¼ ì •í™•ë„ ê°œì„ 
    - skip_framesë¥¼ ê³ ë ¤í•œ ì‹¤ì œ fps ê³„ì‚° (30fps/3 = 10fps)
    - í”„ë¦¬ë²„í¼: 3ì´ˆ Ã— 10fps = 30í”„ë ˆì„ìœ¼ë¡œ ì •í™•íˆ ì„¤ì •
  2. í”„ë ˆì„ë ˆì´íŠ¸ í†µì¼ (30fps)
    - OpenCV í”„ë¦¬ë²„í¼: 25fps â†’ 30fps
    - rpicam-vid í¬ìŠ¤íŠ¸ë²„í¼: 30fps (ìœ ì§€)
    - ffmpeg ë³‘í•©: 25fps â†’ 30fps
  3. ë²„í¼ ì‹œê°„ ì¡°ì •
    - í”„ë¦¬ë²„í¼: 10ì´ˆ â†’ 3ì´ˆ
    - í¬ìŠ¤íŠ¸ë²„í¼: 20ì´ˆ â†’ 27ì´ˆ
    - ì´ 30ì´ˆ ìœ ì§€
  4. ë¡œê·¸ ê°•í™”
    - ë²„í¼ ì €ì¥ ì‹œ ì‹¤ì œ ì‹œê°„ê³¼ í”„ë ˆì„ ìˆ˜ í‘œì‹œ
    - ë³‘í•© ì „ pre/post ë²„í¼ ì‹œê°„ ëª…ì‹œ
    - ë³‘í•© í›„ ì‹¤ì œ duration ê²€ì¦
  5. duration ê²€ì¦ ì¶”ê°€
    - ffprobeë¡œ ìµœì¢… ì˜ìƒ ê¸¸ì´ í™•ì¸
    - ì˜ˆìƒê°’(30ì´ˆ)ê³¼ ì°¨ì´ í‘œì‹œ
  

  shinho@raspberrypi:~/shinho/livecam $ python detection_cam0.py
Motion Detection System - Camera 0
========================================
Motion Detection System Initialized - Camera 0
   Camera: 640x480
   Detector: SIMPLE
   ë¯¼ê°ë„: LOW | ì„ê³„ê°’: 10000px | ì¿¨ë‹¤ìš´: 12s | ë‚®ìŒ - íŒ” ì „ì²´ë¥¼ í¬ê²Œ í”ë“¤ ë•Œ ì •ë„ ê°ì§€
   Recording: True
   Recording Resolution: 1280x720
   Pre-buffer: 3s (@ 10fps capture)
   Post-buffer: 27s (@ 30fps capture)
   Total Duration: 30s

ğŸ”§ ì„¤ì • ë³€ê²½ ë°©ë²•:
   ë¯¼ê°ë„ ë³€ê²½: ì½”ë“œ ìƒë‹¨ì˜ CURRENT_SENSITIVITY ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.
   ê°ì§€ê¸° ë³€ê²½: ì½”ë“œ ìƒë‹¨ì˜ DETECTOR_TYPE ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.

ì‚¬ìš© ê°€ëŠ¥í•œ ë¯¼ê°ë„ ì„¤ì •:
  very_low: 15000px, 15s - ë§¤ìš° ë‚®ìŒ - ì‚¬ëŒì´ í™”ë©´ì„ ê±°ì˜ ë‹¤ ê°€ë¡œì§ˆëŸ¬ì•¼ ê°ì§€
  low: 10000px, 12s - ë‚®ìŒ - íŒ” ì „ì²´ë¥¼ í¬ê²Œ í”ë“¤ ë•Œ ì •ë„ ê°ì§€ â† í˜„ì¬ ì„¤ì •
  medium: 6000px, 8s - ë³´í†µ - íŒ”ì´ë‚˜ ì† ì „ì²´ê°€ ì›€ì§ì¼ ë•Œë§Œ ê°ì§€
  high: 3000px, 5s - ë†’ìŒ - ì†ê°€ë½ ë“± ì‘ì€ ë¬¼ì²´ ì›€ì§ì„ë„ ê°ì§€
  very_high: 1000px, 3s - ë§¤ìš° ë†’ìŒ - ë¯¸ì„¸í•œ ë³€í™”, ë…¸ì´ì¦ˆê¹Œì§€ ê°ì§€

Testing camera...
Camera OK
Camera stream started
Motion detection started (Ctrl+C to stop)
Pre-buffering enabled: 3s circular buffer @ 10fps
Monitoring for motion...
Buffer: 3.0s (30 frames @ 10fps)
Background stabilized with 60 frames - motion detection active
Simple Debug: 0 changed pixels
Buffer: 3.0s (30 frames @ 10fps)
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
[07:31:23] Processed 300 frames
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Buffer: 3.0s (30 frames @ 10fps)
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Buffer: 3.0s (30 frames @ 10fps)
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
[07:31:33] Processed 600 frames
Simple Debug: 0 changed pixels
Motion detected: 21701 changed pixels
[2025-09-08 07:31:34] ëª¨ì…˜ì´ ë””í…ë˜ì—ˆìŠµë‹ˆë‹¤. (SimpleMotionDetector)
Stopping detection stream for post-buffer recording...
Motion detected - saving pre-buffer (3s) + recording post-buffer (27s)
Expected total duration: 30s
Pre-buffer saved: buffer_20250908_073134.mp4 (0.3MB, 3.0s @ 30fps output)
Recording 27s post-buffer...
Post-buffer recording in progress...
Merging: pre-buffer (3s) + post-buffer (27s)
Recording completed: motion_event_cam0_20250908_073134.mp4 (0.0MB)
Restarting detection stream...
Camera stream started
Detection stream resumed
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
[07:32:15] Processed 900 frames
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Video merged successfully: motion_event_cam0_20250908_073134.mp4 (5.6MB)
  Final duration: 30.0s (expected: 30s, diff: 0.0s)
Recording saved: motion_event_cam0_20250908_073134.mp4
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Buffer: 3.0s (30 frames @ 10fps)
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
[07:32:24] Processed 1200 frames
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Buffer: 3.0s (30 frames @ 10fps)
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
Buffer: 3.0s (30 frames @ 10fps)
Simple Debug: 0 changed pixels
Simple Debug: 0 changed pixels
[07:32:33] Processed 1500 frames
Simple Debug: 0 changed pixels
Motion detected: 32309 changed pixels
[2025-09-08 07:32:35] ëª¨ì…˜ì´ ë””í…ë˜ì—ˆìŠµë‹ˆë‹¤. (SimpleMotionDetector)
Stopping detection stream for post-buffer recording...
Motion detected - saving pre-buffer (3s) + recording post-buffer (27s)
Expected total duration: 30s
Pre-buffer saved: buffer_20250908_073235.mp4 (0.3MB, 3.0s @ 30fps output)
Recording 27s post-buffer...
Post-buffer recording in progress...
^C
Shutting down motion detection system...
Checking interrupted recording: motion_event_cam0_20250908_073235.mp4
Merging: pre-buffer (3s) + post-buffer (27s)
Recording file too small (48 bytes), deleting: motion_event_cam0_20250908_073235.mp4
Deleted corrupted file: motion_event_cam0_20250908_073235.mp4
Cleaning up temporary files...
Cleaned up temp file: temp_post_20250908_073235.h264
Cleaned up list file: concat_motion_event_cam0_20250908_073235.txt
Motion detection system stopped
Motion detection system stopped

- í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ë¬¸ì œ í•´ê²°

  ì£¼ìš” ë³€ê²½ ë‚´ìš©:

  1. ë³‘í•© ìŠ¤ë ˆë“œ ê´€ë¦¬ ê°œì„ 
    - merge_thread ì¶”ì  ë³€ìˆ˜ ì¶”ê°€
    - daemon=True â†’ daemon=Falseë¡œ ë³€ê²½ (ì •ìƒ ì¢…ë£Œ ë³´ì¥)
    - ìŠ¤ë ˆë“œ ì¢…ë£Œ ì‹ í˜¸ (merge_thread_stop) ì¶”ê°€
  2. í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ê°œì„ 
    - SIGTERM ë¨¼ì € ì‹œë„ (ì •ìƒ ì¢…ë£Œ)
    - 2ì´ˆ ëŒ€ê¸° í›„ SIGKILL (ê°•ì œ ì¢…ë£Œ)
    - ë³‘í•© ìŠ¤ë ˆë“œ ì¢…ë£Œ ëŒ€ê¸° (3ì´ˆ íƒ€ì„ì•„ì›ƒ)
  3. ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ ê°•í™”
  # ëª¨ë“  ìŠ¤ë ˆë“œ ì¢…ë£Œ ëŒ€ê¸°
  for thread in threading.enumerate():
      if thread != threading.main_thread() and thread.is_alive():
          thread.join(timeout=1)
  4. ì •ë¦¬ ìˆœì„œ ìµœì í™”
    - ë…¹í™” í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ â†’ íŒŒì¼ í™•ì¸ â†’ ë²„í¼ ì •ë¦¬ â†’ ì„ì‹œ íŒŒì¼ ì •ë¦¬

  ì´ì œ Ctrl+C ì¢…ë£Œ ì‹œ:
  - ëª¨ë“  subprocessê°€ ì •ìƒ ì¢…ë£Œë¨
  - ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°
  - í”„ë¡¬í”„íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ë³µêµ¬ë¨

  - í”„ë¦¬ë²„í¼ ì •í™•ë„ ê°œì„ 

  ì£¼ìš” ë³€ê²½ ë‚´ìš©:

  1. í”„ë ˆì„ ë³µì œë¡œ ì •í™•í•œ 5ì´ˆ êµ¬í˜„
    - 10fpsë¡œ ìº¡ì²˜í•œ 50í”„ë ˆì„ì„ ê°ê° 3ë²ˆì”© ë³µì œ
    - 50í”„ë ˆì„ Ã— 3 = 150í”„ë ˆì„ @ 30fps = 5ì´ˆ
    - ì´ì œ í”„ë¦¬ë²„í¼ê°€ ì •í™•íˆ 5ì´ˆê°€ ë©ë‹ˆë‹¤
  2. ffmpeg ìµœì í™”
    - íƒ€ì„ì•„ì›ƒ: 30ì´ˆ â†’ 60ì´ˆ
    - -preset fast ì¶”ê°€ (ì¸ì½”ë”© ì†ë„ í–¥ìƒ)
    - -pix_fmt yuv420p ì¶”ê°€ (í˜¸í™˜ì„± í–¥ìƒ)
    - -r 30 ì¶”ê°€ (í”„ë ˆì„ë ˆì´íŠ¸ í†µì¼)
  3. í–¥ìƒëœ ë¡œê·¸
    - Duration ë¶ˆì¼ì¹˜ ì‹œ ê²½ê³  ë©”ì‹œì§€
    - ì‹¤ì œ vs ì˜ˆìƒ duration ëª…í™•íˆ í‘œì‹œ

  ì˜ˆìƒ ê²°ê³¼:

  Pre-buffer saved: buffer_20250908_075200.mp4
    - Frames: 50 frames @ 10fps capture
    - Duration: 5.0s (expected: 5.0s)  âœ…
    - File size: 0.5MB

  ì´ì œ í”„ë¦¬ë²„í¼ê°€ ì •í™•íˆ 5ì´ˆë¡œ ì €ì¥ë˜ê³ , ffmpeg ë³‘í•©ë„ ì•ˆì •ì ìœ¼ë¡œ ì‘ë™í• 
  ê²ƒì…ë‹ˆë‹¤!

íƒ€ì„ì•„ì›ƒ ì¢…ë¥˜ ì„¤ëª…

  1. ffmpeg ë³‘í•© íƒ€ì„ì•„ì›ƒ (30ì´ˆ â†’ 60ì´ˆ) âœ…

  result = subprocess.run(merge_cmd, capture_output=True, timeout=60)
  - ì´ê²ƒì€ ffmpeg ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œê°„ ì œí•œì…ë‹ˆë‹¤.
  - ì˜ìƒ ë³‘í•© ì‘ì—…ì´ 60ì´ˆ ë‚´ì— ì™„ë£Œë˜ì–´ì•¼ í•¨.
  - ëª¨ì…˜ ê°ì§€ì™€ëŠ” ë¬´ê´€í•©ë‹ˆë‹¤.

  2. ëª¨ì…˜ ê°ì§€ ì¿¨ë‹¤ìš´ (í˜„ì¬ 12ì´ˆ)

  SENSITIVITY_LEVELS = {
      'low': {
          'threshold': 10000,
          'cooldown': 12,  # â† ì´ê²ƒì´ ë‹¤ìŒ ê°ì§€ê¹Œì§€ ëŒ€ê¸° ì‹œê°„
      }
  }
  - ëª¨ì…˜ ê°ì§€ í›„ 12ì´ˆ ë™ì•ˆ ìƒˆë¡œìš´ ëª¨ì…˜ì„ ë¬´ì‹œ
  - ì´ ì‹œê°„ì´ ë‹¤ìŒ ëª¨ì…˜ ê°ì§€ê¹Œì§€ì˜ ì‹¤ì œ ëŒ€ê¸° ì‹œê°„

  ì‹¤ì œ íƒ€ì„ë¼ì¸

  ëª¨ì…˜ ê°ì§€ â†’ ë…¹í™”(30ì´ˆ) â†’ ë³‘í•©(ìµœëŒ€ 60ì´ˆ í—ˆìš©) â†’ 12ì´ˆ í›„ ë‹¤ì‹œ ê°ì§€ ê°€ëŠ¥
       â†‘                                              â†‘
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 12ì´ˆ ì¿¨ë‹¤ìš´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ìš”ì•½:

  - ffmpeg íƒ€ì„ì•„ì›ƒ 60ì´ˆ: ë³‘í•© ì‘ì—… ì‹œê°„ ì œí•œ (ì‹¤ì œë¡œëŠ” ë³´í†µ 5-10ì´ˆë©´ ì™„ë£Œ)
  - ëª¨ì…˜ ê°ì§€ ì¿¨ë‹¤ìš´ 12ì´ˆ: ë‹¤ìŒ ëª¨ì…˜ ê°ì§€ê¹Œì§€ ëŒ€ê¸° ì‹œê°„
  - ë‹¤ìŒ ëª¨ì…˜ì€ 12ì´ˆ í›„ì— ê°ì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤!